---
title: "Substitutions"
output: html_notebook
---

 
# /scratch/wally/FAC/FBM/DBC/amalaspi/virome/yarizmen/simulations_Feb_2020b/Prueba/Sustituciones/Total_Match_Mismatch_CIGAR_VDiarr_* The first column is the number of matches, the second column the number of mismatches. Thereâ€™s one row per read. The last part of the file name gives you the qShift value used, e.g. for Total_Match_Mismatch_CIGAR_VDiarr_neg_10 a qShift value of -10 was used.
```{r}
library(data.table)
path <- "/Users/sneuensc/Sapfo/virome_yami/seq_error_substitution/"

lengths <- c(0, 1, 3, 5, 7, 9, 11, 13, 15)
lengths <- c(0, 3, 7, 11)

data1 <- NULL
for(i in lengths){
  tmp <- fread(paste0(path, "Total_Match_Mismatch_CIGAR_VDiarr_neg_", i))
  #tmp2 <- data.frame(table(tmp$V2))
  data1 <- rbind(data1, c(sum(tmp$V2) / nrow(tmp), i))
}
colnames(data1) <- c("sub","length")
data1 <- data.table(data1)
data1$model <- "sequencing_error"
data1$length <- -1 * data1$length
to.error <- function(x)return(round(1/(10^(x/10)),1))
data1$length2 <- to.error(data1$length)

data1$text <- paste0(to.error(data1$length) , " (", data1$length, ")")
data1$text <- factor(data1$text, levels = data1$text)


```

```{r}
#/scratch/wally/FAC/FBM/DBC/amalaspi/virome/yarizmen/simulations_Feb_2020b/results_Mapeo_No_Deam_length_60 without deamination
#/scratch/wally/FAC/FBM/DBC/amalaspi/virome/yarizmen/simulations_Feb_2020b/Deamination/Deam_singlstr_0/results_Mapeo with 0.05 deamination
#/scratch/wally/FAC/FBM/DBC/amalaspi/virome/yarizmen/simulations_Feb_2020b/Deamination/Deam_singlstr_3/results_Mapeo_Deam_3 with 0.3 deamination
#/scratch/wally/FAC/FBM/DBC/amalaspi/virome/yarizmen/simulations_Feb_2020b/Deamination/Deam_singlstr_5/results_Mapeo_Deam_5 with 0.5 deamination

library(data.table)
library(ggplot2)
path <- "/Users/sneuensc/Sapfo/virome_yami/deamination_substitution/"
files <- list.files(path)

f <- files[1]

lengths <- c('no','0','3','5' )
lengths <- c('0','3','5' )

data2 <- NULL
for(i in lengths){
  tmp <- fread(paste0(path, "misincorporation_", i, ".txt"))
  data2 <- rbind(data2, c(sum(tmp[1:60, 10:21]) / tmp$Total[1], i))
}
colnames(data2) <- c("sub","length")
data2 <- data.table(data2)
data2$model <- "deamination"
data2$length[-1] <- as.numeric(paste0("0.", data2$length[-1]))
data2$sub <- as.numeric(data2$sub)
data2$length <- factor(data2$length, levels = data2$length)
```


```{r}

ymax <- max(data1$sub, data2$sub)
b <- ggplot(data1, aes(x = text, y = sub)) +
  geom_bar(stat="identity") +
  geom_text(aes(label = round(sub,2)), position=position_dodge(width=0.9), vjust=-0.25, cex=3.5) +
  xlab("fold increase of substitutions (qShift)") +
  ylab("Mean number of substitutions [per 60bp]") +
  ylim(0,ymax) +
  theme_classic() +
  ggtitle("B. Sequencing error simulations") +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        panel.grid.major.y = element_line())

a <- ggplot(data2, aes(x = length, y = sub)) +
  geom_bar(stat="identity") +
  geom_text(aes(label = round(sub,2)), position=position_dodge(width=0.9), vjust=-0.25, cex=3.5) +
  xlab("single-stranded probability of deamination") +
  ylab("Mean number of substitutions [per 60bp]") +
  ylim(0,ymax) +
  theme_classic() +
  theme(panel.grid.major.y = element_line()) +
  ggtitle("A. Deamination simulations")

file <- "/Users/sneuensc/Dropbox (popgen)/Virome/PLoS_ONE_virome/sam/figure_3_substitutions.pdf"
  library(gridExtra)
  library(grid)
  
  lay <- rbind(c(rep(1,5), rep(2, 6)))
  grob <- grid.arrange(grobs=list(a, b), layout_matrix=lay)   
  
  ggsave(file, width = 297, height = 210, scale=0.8, units = "mm", grob)
```

